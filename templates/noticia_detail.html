{% load static %}
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ noticia.title }} — Notícia</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{% static 'style.css' %}">
  <style>
    .noticia-article { max-width:900px; margin: 0 auto; }
    .noticia-text { text-align: justify; text-justify: inter-word; }
    .noticia-meta { color: #bbb; font-size: .9rem; margin-bottom: 12px; }
    .share-buttons { display:flex; gap:10px; margin-top:16px; flex-wrap:wrap }
    .btn-share { display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:8px; color:#fff; background:#c72a2a; border:2px solid #fff; text-decoration:none }
    .btn-share i { font-size:16px }
    @media(max-width:600px){ .noticia-article{padding:0 12px;} .btn-share{flex:1;justify-content:center} }
  </style>
</head>
<body>
  <header class="topbar">
  <script>
    // Live search preview
    (function(){
      const input = document.getElementById('siteSearchInput');
      const preview = document.getElementById('searchPreview');
      let controller = null;
      function clearPreview(){ preview.innerHTML=''; preview.setAttribute('aria-hidden','true'); }
      function render(data){
        preview.innerHTML = '';
        const wrap = document.createElement('div'); wrap.className = 'search-preview-wrap';
        const noticias = data.noticias || [];
        const conquistas = data.conquistas || [];
        if(noticias.length){ const h = document.createElement('div'); h.className='preview-cat'; h.textContent='Notícias'; wrap.appendChild(h);
          noticias.forEach(n=>{ const a=document.createElement('a'); a.href='/noticias/'+n.slug+'/'; a.className='preview-item'; a.innerHTML=`<div class="p-title">${n.title}</div><div class="p-meta">${n.created_at}</div>`; wrap.appendChild(a); }); }
        if(conquistas.length){ const h2 = document.createElement('div'); h2.className='preview-cat'; h2.textContent='Conquistas'; wrap.appendChild(h2);
          conquistas.forEach(c=>{ const a=document.createElement('a'); a.href='/conquistas/'+c.slug+'/'; a.className='preview-item'; a.innerHTML=`<div class="p-title">${c.title}</div><div class="p-meta">${c.created_at}</div>`; wrap.appendChild(a); }); }
        if(!noticias.length && !conquistas.length){ const e = document.createElement('div'); e.className='preview-empty'; e.textContent='Nenhum resultado rápido encontrado'; wrap.appendChild(e); }
        preview.appendChild(wrap); preview.setAttribute('aria-hidden','false');
      }
      if(!input) return;
      input.addEventListener('input', function(){
        const q = this.value.trim(); if(controller){ controller.abort(); controller=null; }
        if(!q){ clearPreview(); return; }
        controller = new AbortController();
        fetch(`/search_ajax/?q=${encodeURIComponent(q)}`, {signal: controller.signal}).then(r=>r.json()).then(data=> render(data)).catch(()=>{});
      });
      document.addEventListener('click', function(e){ if(!preview.contains(e.target) && e.target !== input) clearPreview(); });
    })();
  </script>
    <div class="logo">
      <a href="/" class="logo-icon"><img src="{% static 'img/logo.png' %}" alt="Logo"></a>
    </div>
    <nav class="main-nav">
      <a class="nav-item" href="/">Início</a>
      <a class="nav-item" href="{% url 'conquistas' %}">Conquistas</a>
      <a class="nav-item" href="#noticias">Notícias</a>
      <a class="nav-item" href="#contato">Contato</a>
    </nav>
    <div class="site-search">
      <form action="{% url 'search_results' %}" method="get" class="search-form">
        <input id="siteSearchInput" name="q" type="search" placeholder="Pesquisar notícias e conquistas..." autocomplete="off">
      </form>
      <div id="searchPreview" class="search-preview" aria-hidden="true"></div>
    </div>
    <button class="hamburger" aria-label="Abrir menu" aria-expanded="false" aria-controls="mobileMenu">
      <span></span><span></span><span></span>
    </button>
    <button id="mobileToggle" aria-label="Abrir menu mobile" aria-expanded="false">
      <span class="bar"></span>
    </button>
  </header>
  <div id="mobileOverlay" aria-hidden="true"></div>
  <aside id="mobileDrawer" aria-hidden="true">
    <nav class="mobile-drawer-nav">
      <a class="mobile-drawer-item" href="/">Início</a>
      <a class="mobile-drawer-item" href="{% url 'conquistas' %}">Conquistas</a>
      <a class="mobile-drawer-item" href="#noticias">Notícias</a>
      <a class="mobile-drawer-item" href="#contato">Contato</a>
    </nav>
    <div class="mobile-phone" style="margin-top:12px;color:#ddd">Telefone: (84) 9 9933-1686</div>
  </aside>

  <main class="section py-5">
    <div class="container noticia-article">
      <article>
        <h1 class="mb-3">{{ noticia.title }}</h1>
        {% if noticia.image %}
        <img src="{{ noticia.image.url }}" alt="{{ noticia.title }}" class="img-fluid mb-3">
        {% endif %}
        <div class="noticia-meta">Publicado em {{ noticia.created_at|date:"d/m/Y H:i" }}</div>
        <div class="noticia-text">{{ noticia.text|linebreaks }}</div>

        <div class="share-buttons">
          <a href="#" class="btn-share" id="share-facebook"><i class="fab fa-facebook-f"></i> Facebook</a>
          <a href="#" class="btn-share" id="share-whatsapp"><i class="fab fa-whatsapp"></i> WhatsApp</a>
          <a href="#" class="btn-share" id="share-instagram"><i class="fab fa-instagram"></i> Instagram</a>
        </div>
      </article>
    </div>
  </main>

  <footer class="main-footer">
    <div class="container">
      <div class="footer-bottom text-center">
        <p>&copy; 2026 Hudson Matheus. Todos os direitos reservados.</p>
      </div>
    </div>
  </footer>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
  <script>
    (function(){
      const url = window.location.href;
      const title = document.title;

      document.getElementById('share-facebook').addEventListener('click', function(e){
        e.preventDefault();
        const shareUrl = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(url);
        window.open(shareUrl,'_blank','width=600,height=400');
      });

      document.getElementById('share-whatsapp').addEventListener('click', function(e){
        e.preventDefault();
        const shareUrl = 'https://wa.me/?text=' + encodeURIComponent(title + ' ' + url);
        window.open(shareUrl,'_blank');
      });

      // Instagram: não fornece share via URL; copiamos link para o clipboard e instruímos
      document.getElementById('share-instagram').addEventListener('click', async function(e){
        e.preventDefault();
        try{
          await navigator.clipboard.writeText(url);
          alert('Link copiado para a área de transferência. Abra o Instagram e cole o link na descrição ou mensagem.');
        }catch(err){
          prompt('Copie o link abaixo e cole no Instagram:', url);
        }
      });
    })();
  </script>
  <script>
    (function(){
      const oldBtn = document.querySelector('.hamburger');
      const btn = document.getElementById('mobileToggle');
      const overlay = document.getElementById('mobileOverlay');
      const drawer = document.getElementById('mobileDrawer');
      if(!btn || !overlay || !drawer) return;
      function open(){ btn.classList.add('open'); btn.setAttribute('aria-expanded','true'); overlay.classList.add('open'); overlay.setAttribute('aria-hidden','false'); drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false'); }
      function close(){ btn.classList.remove('open'); btn.setAttribute('aria-expanded','false'); overlay.classList.remove('open'); overlay.setAttribute('aria-hidden','true'); drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); }
      function toggle(){ if(drawer.classList.contains('open')) close(); else open(); }
      btn.addEventListener('click', function(e){ e.stopPropagation(); toggle(); });
      overlay.addEventListener('click', close);
      document.addEventListener('keydown', function(e){ if(e.key === 'Escape') close(); });
      drawer.addEventListener('click', function(e){ e.stopPropagation(); });
      if(oldBtn){ oldBtn.addEventListener('click', function(e){ e.preventDefault(); toggle(); }); }
    })();
  </script>
</body>
</html>
